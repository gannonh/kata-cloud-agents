graph TD
    subgraph "WAVE 0 - External prerequisites (M0)"
        KAT105["KAT-105<br/>Define core TypeScript types<br/><b>P1 - Done</b>"]
        KAT106["KAT-106<br/>PostgreSQL schema + Drizzle migrations<br/><b>P1 - Done</b>"]
        KAT107["KAT-107<br/>Desktop navigation shell<br/><b>P1 - Done</b>"]
        KAT108["KAT-108<br/>API server skeleton (Hono)<br/><b>P1 - Done</b>"]
        KAT109["KAT-109<br/>WebSocket server for real-time updates<br/><b>P2 - In Progress</b>"]
    end

    subgraph "WAVE 1 - M1 foundations"
        KAT111["KAT-111<br/>Spec YAML schema, parser, and validator<br/><b>P0 - Urgent</b>"]
        KAT114["KAT-114<br/>Docker-based InfraAdapter<br/><b>P0 - Urgent</b>"]
    end

    subgraph "WAVE 2 - Core M1 capabilities"
        KAT113["KAT-113<br/>Spec versioning system<br/><b>P2 - Medium</b>"]
        KAT115["KAT-115<br/>Single-agent Coordinator runtime<br/><b>P0 - Urgent</b>"]
    end

    subgraph "WAVE 3 - Dispatch + editor integration"
        KAT116["KAT-116<br/>Agent dispatch pipeline<br/><b>P0 - Urgent</b>"]
        KAT112["KAT-112<br/>Spec editor UI with CodeMirror<br/><b>P1 - High</b>"]
    end

    subgraph "WAVE 4 - End-user run visibility"
        KAT117["KAT-117<br/>Agent Monitor UI (live logs/status)<br/><b>P1 - High</b>"]
        KAT118["KAT-118<br/>Result viewer (diffs/task status/output)<br/><b>P1 - High</b>"]
    end

    KAT105 --> KAT111
    KAT105 --> KAT114

    KAT111 --> KAT113
    KAT106 --> KAT113
    KAT108 --> KAT113

    KAT111 --> KAT115

    KAT109 --> KAT116
    KAT113 --> KAT116
    KAT114 --> KAT116
    KAT115 --> KAT116

    KAT107 --> KAT112
    KAT111 --> KAT112
    KAT113 --> KAT112

    KAT109 --> KAT117
    KAT116 --> KAT117

    KAT113 --> KAT118
    KAT116 --> KAT118

    classDef ext fill:#334155,color:#fff,stroke:#1e293b
    classDef wave1 fill:#dc2626,color:#fff,stroke:#991b1b
    classDef wave2 fill:#2563eb,color:#fff,stroke:#1d4ed8
    classDef wave3 fill:#7c3aed,color:#fff,stroke:#6d28d9
    classDef wave4 fill:#059669,color:#fff,stroke:#047857

    class KAT105,KAT106,KAT107,KAT108,KAT109 ext
    class KAT111,KAT114 wave1
    class KAT113,KAT115 wave2
    class KAT116,KAT112 wave3
    class KAT117,KAT118 wave4
